{% extends 'cvn/base.html' %}

{% load staticfiles %}

{% block breadcrumb %}
    <li class="active"><a href='{% url 'cvn' %}'>CVN</a></li>
{% endblock breadcrumb %}

{% block main %}
    <h1 class="page-header">Currículum Vítae Normalizado (CVN) </h1>
    {% if not cvn or cvn.status == CVNStatus.EXPIRED %}
        <div class="alert alert-danger">
            Debe introducir un <i>Currículum Vítae Normalizado</i> con formato <i>FECYT</i>
        </div>
    {% endif %}
    <!-- Tabla de estado del CVN -->
    <div class="row">
        {% if cvn %}
            <div class="col-md-6">
                <table class="table table-striped table-bordered">
                    <tbody>
                    <tr>
                        <td><strong>Estado</strong></td>
                        <td>
                            {% if cvn %}   <!-- Tiene CVN subido -->
                                <strong>{{ cvn_status }}</strong>
                            {% else %}
                                <strong>Sin CVN</strong>
                            {% endif %}
                        </td>
                    </tr>
                    {% if cvn %}
                        <tr>
                            <td><strong>Fecha de última actualización</strong></td>
                            <td>
                                {{ cvn.fecha_cvn }}
                            </td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>
        {% endif %}

        <div class="col-md-6">
            <div class="thumbnail" align="center">
                <div style="background-color: #F5F5F5; padding: 20px 20px 20px; margin-top: 0px; margin-bottom: 0px; border-top: 1px solid #E5E5E5;" class="form-group">
                    {% if message %}
                        <div class="alert alert-success">
                            {{ message }}
                        </div>
                    {% endif %}
                    {% if form.errors %}
                        <div class="alert  alert-danger">
                            {% for field in form %}
                                {{ field.errors }}
                            {% endfor %}
                        </div>
                    {% endif %}
                    <div>
                        <form action="" method='post'
                            {% if form.is_multipart %} 
                                enctype="multipart/form-data"
                            {% endif %}>{% csrf_token %}
                            {% for field in form.visible_fields %}
                                {{ field }}
                            {% endfor %}
                            <br>
                            <button type="submit" class="btn btn-success btn-block btn-ms">Subir</button>
                        </form>
                    </div>
                </div>
                <br>
                <div class="alert alert-info">
                    Actualice su CVN
                </div>
            </div>
        </div>
    </div>

<!-- Datos de los cvn Subidos -->
{% if CVN %}
    <hr>
    <div class="tabbable">
          <ul class="nav nav-tabs">
                <li class="active"><a href="#congreso" data-toggle="tab">Congresos</a></li>
                <li><a href="#publicacion" data-toggle="tab">Publicaciones</a></li>
                <li><a href="#convenio" data-toggle="tab">Convenios</a></li>
                <li><a href="#proyecto" data-toggle="tab">Proyectos</a></li>
                <li><a href="#tesis" data-toggle="tab">Tesis</a></li>
          </ul>
          <div class="tab-content">
                <div id="congreso" class="tab-pane active">
                    <div class="panel-group" id="congresos">
                    {% if Congresos %}
                        {% for congreso in Congresos %}
                            <div class="panel panel-default in" >
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#c{{congreso.id}}">
                                    {{ congreso.titulo  }}</a>
                                </div>
                                <div id="c{{congreso.id}}" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <h5>{{ congreso.nombre_del_congreso }}</h5>
                                        {% if congreso.fecha_de_inicio %}
                                        <strong>Fecha de realización:</strong> {{ congreso.fecha_de_inicio }} <br>
                                        {% endif %}
                                        {% if congreso.fecha_de_fin %}
                                        <strong>Fecha de finalización:</strong> {{ congreso.fecha_de_fin }}<br>
                                        {% endif %}
                                        {% if congreso.ciudad_realizacion %}
                                        <strong>Ciudad realización:</strong> {{ congreso.ciudad_realizacion }}<br>
                                        {% endif %}
                                        {% if congreso.autores %}
                                        <strong>Autores:</strong> {{ congreso.autores }} <br>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-warning">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>No dispone de congresos</strong>
                        </div>
                    {% endif %}
                    </div>
                </div>
                <div id="publicacion" class="tab-pane">
                    <div class="panel-group" id="publicaciones">
                    {% if Publicaciones %}
                        {% for publicacion in Publicaciones %}
                            <div class="panel panel-default" >
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#pub{{publicacion.id}}">
                                        <span class="label label-default">{{ publicacion.tipo_de_produccion }}</span>
                                        {{ publicacion.titulo }}
                                    </a>
                                </div>
                                <div id="pub{{publicacion.id}}" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        {% if publicacion.nombre_publicacion %}
                                        <h5>{{ publicacion.nombre_publicacion }} </h5>
                                        {% endif %}
                                        {% if publicacion.fecha %}
                                        <strong>Fecha:</strong> {{ publicacion.fecha }}<br>
                                        {% endif %}
                                        {% if publicacion.autores %}
                                        <strong>Autores:</strong> {{ publicacion.autores }} <br>
                                        {% endif %}
                                        {% if publicacion.issn %}
                                        <strong>ISSN:</strong> {{ publicacion.issn }}<br>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-warning">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>No dispone de publicaciones</strong>
                        </div>
                    {% endif %}
                    </div>
                </div>
                <div id="convenio" class="tab-pane">
                    <div class="panel-group" id="convenios">
                    {% if Convenios %}
                        {% for convenio in Convenios %}
                            <div class="panel panel-default" >
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#conv{{convenio.id}}">
                                    {{ convenio.denominacion_del_proyecto }}</a>
                                </div>
                                <div id="conv{{convenio.id}}" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        {% if fecha_de_inicio %}
                                        <strong>Fecha de incio:</strong>{{ convenio.fecha_de_inicio }}<br>
                                        {% endif %}
                                        {% if fecha_de_fin %}
                                        <strong>Fecha de fin:</strong>{{ convenio.fecha_de_fin }}<br>
                                        {% endif %}
                                        {% if convenio.cod_segun_financiadora %}
                                        <strong>Código según financiadora:</strong> {{ convenio.cod_segun_financiadora }}<br>
                                        {% endif %}
                                        {% if convenio.cuantia_total %}
                                        <strong>Cuantía Total:</strong> {{ convenio.cuantia_total }} <br>
                                        {% endif %}
                                        {% if convenio.cuantia_subproyecto %}
                                        <strong>Cuantía Subproyecto:</strong> {{ convenio.cuantia_subproyecto }} <br>
                                        {% endif %}
                                        {% if convenio.porcentaje_en_subvencion %}
                                        <strong>Porcentaje en subvención:</strong> {{ convenio.porcentaje_en_subvencion }}% <br>
                                        {% endif %}
                                        {% if convenio.porcentaje_en_credito %}
                                        <strong>Porcentaje en crédito:</strong> {{ convenio.porcentaje_en_credito }}%<br>
                                        {% endif %}
                                        {% if convenio.porcentaje_mixto %}
                                        <strong>Porcentaje mixto:</strong> {{ convenio.porcentaje_mixto }}%<br>
                                        {% endif %}
                                        {% if convenio.autores %}
                                        <strong>Autores:</strong> {{ convenio.autores }} <br>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-warning">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>No dispone de convenios</strong>
                        </div>
                    {% endif %}
                    </div>
                </div>
                <div id="proyecto" class="tab-pane">
                    <div class="panel-group" id="proyectos">
                    {% if Proyectos %}
                        {% for proyecto in Proyectos %}
                            <div class="panel panel-default" >
                                <div class="panel-heading">

                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#pro{{proyecto.id}}">
                                    {{ proyecto.denominacion_del_proyecto  }}</a>
                                </div>
                                <div id="pro{{proyecto.id}}" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <strong>Fecha de inicio:</strong>{{ proyecto.fecha_de_inicio }}<br>
                                        {% if proyecto.fecha_de_fin %}
                                        <strong>Fecha de fin:</strong>{{ proyecto.fecha_de_fin }}<br>
                                        {% endif %}
                                        {% if proyecto.cod_segun_financiadora %}
                                        <strong>Código según financiadora:</strong> {{ proyecto.cod_segun_financiadora }}<br>
                                        {% endif %}
                                        {% if proyecto.cuantia_total %}
                                        <strong>Cuantía Total:</strong> {{ proyecto.cuantia_total }} <br>
                                        {% endif %}
                                        {% if proyecto.cuantia_subproyecto %}
                                        <strong>Cuantía Subproyecto:</strong> {{ proyecto.cuantia_subproyecto }} <br>
                                        {% endif %}
                                        {% if proyecto.porcentaje_en_subvencion %}
                                        <strong>Porcentaje en subvención:</strong> {{ proyecto.porcentaje_en_subvencion }}% <br>
                                        {% endif %}
                                        {% if proyecto.porcentaje_en_credito %}
                                        <strong>Porcentaje en crédito:</strong> {{ proyecto.porcentaje_en_credito }}%<br>
                                        {% endif %}
                                        {% if proyecto.porcentaje_mixto %}
                                        <strong>Porcentaje mixto:</strong> {{ proyecto.porcentaje_mixto }}%<br>
                                        {% endif %}
                                        {% if proyecto.autores %}
                                        <strong>Autores:</strong> {{ proyecto.autores }} <br>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-warning">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>No dispone de proyectos</strong>
                        </div>
                    {% endif %}
                    </div>
                </div>
                <div id="tesis" class="tab-pane">
                    <div class="panel-group" id="tesisDocs">
                    {% if TesisDoctorales %}
                        {% for tesis in TesisDoctorales %}
                            <div class="panel panel-default" >
                                <div class="panel-heading">
                                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#tes{{tesis.id}}">
                                    {{ tesis.titulo  }}</a>
                                </div>
                                <div id="tes{{tesis.id}}" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <h5>{{ tesis.fecha_de_lectura }}</h5>
                                        {% if tesis.autor %}
                                        <strong>Autor:</strong> {{ tesis.autor }} <br>
                                        {% endif %}
                                        {% if tesis.codirector %}
                                        <strong>Codirector:</strong> {{ tesis.codirector }}<br>
                                        {% endif %}
                                        {% if tesis.universidad_que_titula %}
                                        <strong>Universidad:</strong> {{ tesis.universidad_que_titula }}<br>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="alert alert-warning">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <strong>No dispone de tesis doctorales</strong>
                        </div>
                    {% endif %}
                    </div>
                </div>
          </div>
    </div>
{% endif %}
{% endblock main %}
